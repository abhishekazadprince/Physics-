<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <title>KalaSimX</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax for nice equations -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; font-family: 'Segoe UI', sans-serif; background-color: #0f172a; color: white; overscroll-behavior-y: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        canvas { touch-action: none; border-radius: 12px; }
        .gold-text { color: #fbbf24; font-weight: bold; }
        .btn-press:active { transform: scale(0.95); transition: 0.1s; }
    </style>
</head>
<body>

<div id="root" class="w-full h-[100dvh] flex flex-col max-w-md mx-auto bg-slate-900 shadow-2xl relative overflow-hidden"></div>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('sw.js').catch(e => console.log(e)));
    }
</script>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

// --- ICONS ---
const Icons = {
    Menu: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>,
    Back: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>,
    Calc: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="8" y2="6"/><line x1="16" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="8" y2="10"/><line x1="16" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="16" y2="18"/></svg>,
    Atom: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="1"/><path d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z"/><path d="M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z"/></svg>,
    Home: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
    Download: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
};

// --- CONTENT ---
const SIMS = [
    { id: 'mech', title: 'Classical Mechanics', eq: 'x(t) = v_0 t + \\frac{1}{2}at^2', desc: 'Projectile & Motion', color: 'bg-blue-600' },
    { id: 'wave', title: 'Wave Dynamics', eq: 'y(x,t) = A \\sin(\\omega t - kx)', desc: 'Interference & Beats', color: 'bg-purple-600' },
    { id: 'em', title: 'Electromagnetism', eq: 'V(t) = V_0 \\sin(\\omega t)', desc: 'AC Circuits & Fields', color: 'bg-yellow-600' },
    { id: 'optics', title: 'Optics', eq: 'c = \\frac{d}{t}', desc: 'Refraction & Speed', color: 'bg-teal-600' },
    { id: 'modern', title: 'Modern Physics', eq: 'N(t) = N_0 e^{-\\lambda t}', desc: 'Decay & Bohr Model', color: 'bg-pink-600' },
    { id: 'thermo', title: 'Thermodynamics', eq: '\\frac{dQ}{dt} = kA\\frac{dT}{dx}', desc: 'Heat Flow', color: 'bg-orange-600' },
];

// --- COMPONENTS ---

// 1. Differential Equation Solver
const DiffEqSolver = () => {
    const canvasRef = useRef(null);
    const [k, setK] = useState(0.1); // Decay constant
    
    useEffect(() => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const w = canvas.width = canvas.parentElement.clientWidth;
        const h = canvas.height = 200;
        
        ctx.fillStyle = '#1e293b'; ctx.fillRect(0,0,w,h);
        
        // Axis
        ctx.strokeStyle = '#64748b'; ctx.beginPath();
        ctx.moveTo(0, h/2); ctx.lineTo(w, h/2); ctx.stroke();
        
        // Plot: dy/dt = -ky (Exponential Decay)
        ctx.strokeStyle = '#fbbf24'; ctx.lineWidth = 2; ctx.beginPath();
        for(let x=0; x<w; x++) {
            // Mapping time 't' to x-axis
            const t = x * 0.1;
            const y = 80 * Math.exp(-k * t);
            ctx.lineTo(x, h/2 - y); // Invert y for canvas
        }
        ctx.stroke();

        ctx.fillStyle = '#fff'; ctx.font = "12px monospace";
        ctx.fillText("Equation: dy/dt = -ky", 10, 20);
        ctx.fillStyle = '#fbbf24'; 
        ctx.fillText(`k = ${k}`, 10, 40);
        
    }, [k]);

    return (
        <div className="p-4 bg-slate-800 rounded-xl mb-6">
            <h3 className="font-bold text-lg mb-2 text-white">Differential Solver</h3>
            <p className="text-xs text-slate-400 mb-2 font-mono">Solving: <span className="text-yellow-400">dy/dt = -ky</span></p>
            <div className="rounded-lg overflow-hidden border border-slate-700">
                <canvas ref={canvasRef} className="w-full h-[200px]" />
            </div>
            <div className="mt-4 flex items-center gap-3">
                <span className="text-xs text-slate-400">Parameter k:</span>
                <input type="range" min="0.01" max="0.3" step="0.01" value={k} onChange={e=>setK(e.target.value)} className="flex-1 accent-yellow-500"/>
            </div>
        </div>
    );
};

// 2. Simulation Engine
const SimCanvas = ({ type }) => {
    const canvasRef = useRef(null);
    useEffect(() => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        let t = 0; let id;
        
        const render = () => {
            t += 0.05; // TIME variable
            const w = canvas.width = canvas.parentElement.clientWidth;
            const h = canvas.height = 240;
            const cx = w/2, cy = h/2;
            
            ctx.fillStyle = '#0f172a'; ctx.fillRect(0,0,w,h);
            
            // Draw Time
            ctx.fillStyle = '#334155'; ctx.font = "10px monospace";
            ctx.fillText(`t = ${t.toFixed(1)}s`, 10, h-10);

            if(type === 'mech') {
                // Projectile
                const x = (t * 20) % w;
                const y = cy + 50 * Math.sin(t*2);
                ctx.beginPath(); ctx.arc(x, y, 8, 0, 7); ctx.fillStyle='#3b82f6'; ctx.fill();
                ctx.strokeStyle='#1e293b'; ctx.beginPath(); ctx.moveTo(0,cy); ctx.lineTo(w,cy); ctx.stroke();
            }
            if(type === 'wave') {
                // Standing Wave
                ctx.beginPath(); ctx.strokeStyle='#a855f7'; ctx.lineWidth=2;
                for(let x=0; x<w; x+=2) {
                    const y = cy + 40 * Math.sin(x*0.05 - t*2);
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            if(type === 'em') {
                // AC Circuit Sine
                ctx.beginPath(); ctx.strokeStyle='#eab308'; ctx.lineWidth=2;
                for(let x=0; x<w; x++) {
                    const y = cy - 50 * Math.sin(x*0.05 + t*3);
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
                ctx.fillStyle='#fff'; ctx.fillText('Voltage V(t)', 10, 20);
            }
            if(type === 'modern') {
                // Radioactive Decay Visual
                const particles = 100 * Math.exp(-0.1 * t);
                for(let i=0; i<particles; i++) {
                    const r = i*2; 
                    const angle = i;
                    ctx.beginPath(); ctx.arc(cx + r*Math.cos(angle), cy + r*Math.sin(angle), 2, 0, 7);
                    ctx.fillStyle='#ec4899'; ctx.fill();
                }
                ctx.fillStyle='#fff'; ctx.fillText(`N(t) = ${Math.floor(particles)}`, 10, 20);
            }
            // ... Add others as needed
            
            id = requestAnimationFrame(render);
        };
        render(); return () => cancelAnimationFrame(id);
    }, [type]);
    return <div className="rounded-xl overflow-hidden mt-4 border border-slate-700 shadow-2xl"><canvas ref={canvasRef} className="block w-full h-[240px]"/></div>;
};

// 3. Main Layout
const App = () => {
    const [view, setView] = useState('home');
    const [sim, setSim] = useState(null);
    const [installPrompt, setInstallPrompt] = useState(null);

    useEffect(() => {
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            setInstallPrompt(e);
        });
    }, []);

    const install = () => {
        if(installPrompt) {
            installPrompt.prompt();
            installPrompt.userChoice.then(() => setInstallPrompt(null));
        } else {
            alert("Open Chrome Menu (3 dots) -> Tap 'Add to Home Screen' to install KalaSimX.");
        }
    };

    const Header = () => (
        <div className="flex items-center justify-between p-4 bg-slate-900 border-b border-slate-800 sticky top-0 z-20">
            <div className="flex items-center gap-3" onClick={() => setView('home')}>
                <div className="w-10 h-10 rounded-full overflow-hidden border-2 border-yellow-500 bg-black">
                    {/* LOGO IMAGE LOADER */}
                    <img src="KalaSimX.jpg" alt="K" className="w-full h-full object-cover" onError={(e)=>{e.target.style.display='none';}} />
                </div>
                <div>
                    <h1 className="font-bold text-white leading-none">KalaSimX</h1>
                    <p className="text-[10px] text-yellow-500 tracking-widest uppercase">Kalachakra Dynamics</p>
                </div>
            </div>
            <button className="text-slate-400" onClick={install}><Icons.Download/></button>
        </div>
    );

    return (
        <div className="flex flex-col h-full bg-slate-900 text-slate-100">
            <Header />

            <main className="flex-1 overflow-y-auto p-4 pb-24">
                {view === 'home' && (
                    <div className="space-y-8 animate-in fade-in zoom-in duration-300">
                        {/* HERO CARD */}
                        <div className="bg-gradient-to-br from-slate-800 to-black p-6 rounded-2xl border border-slate-700 shadow-xl text-center relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-10"><Icons.Atom /></div>
                            <img src="KalaSimX.jpg" className="w-24 h-24 mx-auto rounded-full border-4 border-yellow-500 shadow-2xl mb-4 object-cover" onError={(e)=>{e.target.src='https://via.placeholder.com/100?text=K';}} />
                            <h2 className="text-2xl font-bold text-white mb-1">Welcome to KalaSimX</h2>
                            <p className="text-xs text-slate-400 mb-4">Where Time Turns into Motion</p>
                            <button onClick={install} className="w-full py-3 bg-yellow-500 hover:bg-yellow-400 text-black font-bold rounded-lg shadow-lg btn-press flex items-center justify-center gap-2">
                                <Icons.Download /> {installPrompt ? "Install App" : "Install App"}
                            </button>
                        </div>

                        {/* SECTIONS */}
                        <div>
                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Modules</h3>
                            <div className="grid gap-3">
                                <button onClick={() => setView('diffeq')} className="p-4 bg-slate-800 rounded-xl border border-slate-700 flex items-center gap-4 btn-press">
                                    <div className="p-3 bg-red-600 rounded-lg"><Icons.Calc /></div>
                                    <div className="text-left">
                                        <div className="font-bold">Diff. Eq. Solver</div>
                                        <div className="text-xs text-slate-400">Solve dy/dt numerically</div>
                                    </div>
                                </button>

                                {SIMS.map(s => (
                                    <button key={s.id} onClick={() => { setSim(s); setView('sim'); }} className="p-4 bg-slate-800 rounded-xl border border-slate-700 flex items-center gap-4 btn-press text-left">
                                        <div className={`p-3 rounded-lg ${s.color} text-white font-bold text-xs shadow-lg`}>t</div>
                                        <div>
                                            <div className="font-bold">{s.title}</div>
                                            <div className="text-xs text-slate-400 mt-1 font-mono text-yellow-500/80">{s.eq}</div>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {view === 'sim' && sim && (
                    <div className="animate-in slide-in-from-right duration-300">
                        <button onClick={() => setView('home')} className="flex items-center gap-2 text-slate-400 mb-4 font-bold text-sm"><Icons.Back /> Back</button>
                        <h2 className="text-2xl font-bold text-white mb-1">{sim.title}</h2>
                        <p className="text-sm text-yellow-500 font-mono mb-4">{sim.eq}</p>
                        
                        <SimCanvas type={sim.id} />
                        
                        <div className="mt-4 p-4 bg-slate-800 rounded-xl border border-slate-700 text-sm text-slate-300">
                            Observe the gold variable <span className="text-yellow-400 font-bold">t</span> (time). As <span className="text-yellow-400 font-bold">t</span> increases, the system evolves according to the equation.
                        </div>
                    </div>
                )}

                {view === 'diffeq' && (
                    <div className="animate-in slide-in-from-right duration-300">
                        <button onClick={() => setView('home')} className="flex items-center gap-2 text-slate-400 mb-4 font-bold text-sm"><Icons.Back /> Back</button>
                        <DiffEqSolver />
                    </div>
                )}
            </main>
        </div>
    );
};
const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
</script>
</body>
</html>
